---
Description: The previous topic (How the Resource Management System matches and chooses resources) looks at qualifier-matching in general. This topic focuses on language-tag-matching in more detail.
title: 资源管理系统匹配语言标记的方式
template: detail.hbs
ms.date: 11/02/2017
ms.topic: article
keywords: windows 10, uwp, 资源, 图像, 资产, MRT, 限定符
ms.localizationpriority: medium
ms.openlocfilehash: 4914a448432206e2418fe110c0b49517a7145e0b
ms.sourcegitcommit: b5c9c18e70625ab770946b8243f3465ee1013184
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/28/2018
ms.locfileid: "7978217"
---
# <a name="how-the-resource-management-system-matches-language-tags"></a>资源管理系统匹配语言标记的方式

上一个主题（[资源管理系统如何匹配和选择资源](how-rms-matches-and-chooses-resources.md)）对限定符匹配进行总体概括。 本主题主要对语言标记匹配进行详细介绍。

## <a name="introduction"></a>简介

具有语言标记限定符的资源基于应用运行时语言列表进行比较和评分。 有关不同语言列表的定义，请参阅[了解用户配置文件语言和应用清单语言](../design/globalizing/manage-language-and-region.md)。 在与列表中的首个语言匹配之后才会与列表中第二个语言匹配，对于其他区域变体也是如此。 例如，如果应用运行时语言为 en-US，则会先于 fr-CA 资源选择用于 en-GB 的资源。 只有当没有 en 形式的资源时，才会选择 fr-CA 的资源（请注意：在这种情况下，应用的默认语言不能设置为任何形式的 en）。

评分机制使用 [BCP 47](http://go.microsoft.com/fwlink/p/?linkid=227302) 子标记注册表和其他数据源中包含的数据。 它允许存在具有不同匹配度的评分梯度，而且当存在多个候选项时，它会选择具有最佳匹配分数的候选项。

因此，你可以在通用词条中标记语言内容，但在需要时仍然可以指定特定的内容。 例如，你的应用可能具有美国、英国和其他地区通用的许多英语字符串。 将这些字符串标记为“en”（英语）可以节省空间和本地化开销。 当需要进行区分时，如在含有“颜色/色彩”一词的字符串中，可以分别使用语言和地区子标记（如“en-US”和“en-GB”）单独标记美国版本和英国版本。

## <a name="language-tags"></a>语言标记

使用规范化且格式正确的 BCP-47 语言标记标识语言。 子标记组件在 BCP-47 子标记注册表中进行定义。 BCP-47 语言标记的正常结构包含以下一个或多个子标记元素。

- 语言子标记（必需）。
- 脚本子标记（可以使用在子标记注册表中指定的默认值推断）。
- 区域子标记（可选）。
- 变体子标记（可选）。

可能存在其他子标记元素，但它们对语言匹配的影响可以忽略不计。 没有使用通配符（“*”）定义语言范围，如“en-*”。

## <a name="matching-two-languages"></a>匹配两种语言

每当 Windows 比较两种语言时，通常在一个更大进程的上下文中完成。 可能是在评估多种语言的上下文中，如当 Windows 生成应用程序语言列表时（请参阅[了解用户配置文件语言和应用清单语言](../design/globalizing/manage-language-and-region.md)）。 Windows 执行此操作的方式是将来自用户首选项的多种语言匹配到应用清单中指定的语言。 也可能在评估语言和用于特定资源的其他限定符的上下文中进行比较。 一个示例是当 Windows 将一个特定的文件资源解析到一个特定的资源上下文时；用户的主位置或设备的当前比例或 DPI 作为在选择资源时要考虑的其他因素（除语言外）。

比较两种语言标记时，基于匹配的接近程度为比较指定一个分数。

| 匹配 | 分数 | 示例 |
| ----- | ----- | ------- |
| 精确匹配 | 最高 | en-AU : en-AU |
| 变体匹配（语言、脚本、区域、变体） |  | en-AU-variant1 : en-AU-variant1-t-ja |
| 区域匹配（语言、脚本、区域） |  | en-AU : en-AU-variant1 |
| 部分匹配（语言，脚本） |  |  |
| - 宏地区匹配 |  | en-AU : en-053 |
| - 非特定地区匹配 |  | en-AU : en |
| - 正交相关性匹配（有限支持） |  | en-AU : en-GB |
| - 首选地区匹配 |  | en-AU : en-US |
| - 任何地区匹配 |  | en-AU : en-CA |
| 不确定的语言（任何语言匹配） |  | en-AU : und |
| 无匹配（脚本不匹配或主要语言标记不匹配） | 最低 | en-AU : fr-FR |

### <a name="exact-match"></a>精确匹配

标记完全相等（所有子标记元素均匹配）。 比较可以从变体或地区匹配提升到此匹配类型。 例如，en-US 与 en-US 匹配。

### <a name="variant-match"></a>变体匹配

标记在语言、脚本、地区和变体子标记上匹配，但在一些其他方面有所不同。

### <a name="region-match"></a>地区匹配

标记在语言、脚本和地区子标记上匹配，但在一些其他方面有所不同。 例如，de-DE-1996 与 de-DE 匹配，以及 en-US-x-Pirate 与 en-US 匹配。

### <a name="partial-matches"></a>部分匹配

标记在语言和脚本子标记上匹配，但在地区或一些其他子标记上有所不同。 例如，en-US 与 en 匹配，或 en-US 与 en-\* 匹配。

#### <a name="macro-region-match"></a>宏地区匹配

标记在语言和脚本子标记上匹配；两个标记都有地区子标记，其中一个子标记表示包含其他地区的宏地区。 宏地区子标记始终是数字，并且从联合国统计部门 M.49 国家/地区和区域代码衍生而来。 有关包含关系的详细信息，请参阅[宏地理（大陆）区域、地理子区域和所选经济和其他分组的构成](http://go.microsoft.com/fwlink/p/?LinkId=247929)。

**注意**“经济分组”和“其他分组”的 UN 代码在 BCP-47 中不受支持。
 
**注意**具有宏地区子标记“001”的标记被视为等同于非特定地区标记。 例如，“es 001”和“es”被视为同义词。

#### <a name="region-neutral-match"></a>非特定地区匹配

标记在语言和脚本子标记上匹配；且只有一个标记具有地区标记。 父级匹配优先于其他部分匹配。

#### <a name="orthographic-affinity-match"></a>正交相关性匹配

标记在语言和脚本子标记上匹配，且地区子标记具有正交相关性。 相关性依赖于在 Windows 中维护的数据，定义特定于语言的关联地区，如“en-IE”和“en-GB”。

#### <a name="preferred-region-match"></a>首选地区匹配

标记在语言和脚本子标记上匹配，且其中一个地区子标记是该语言的默认地区子标记。 例如，“fr-FR”是“fr”子标记的默认地区。 因此，fr-FR 比 fr-CA 更匹配 fr-BE。 这依赖于在 Windows 中维护的、定义每种 Windows 本地化语言的默认地区的数据。

#### <a name="sibling-match"></a>同级匹配

标记在语言和脚本子标记上匹配，且两者都具有地区子标记，但两者之间没有定义任何其他关系。 存在多个同级匹配时，如果没有更高的匹配，则最后一个枚举的同级胜出。

### <a name="undetermined-language"></a>不确定的语言

可以将资源标记为“und”，表示匹配任何语言。 此标记还可与脚本标记一起使用，用来基于脚本筛选匹配。 例如，“und-Latn”将匹配使用拉丁文脚本的任何语言标记。 有关详细信息，请参阅下方。

### <a name="script-mismatch"></a>脚本不匹配

当标记仅在主要语言标记上匹配，但脚本不匹配时，该配对被视为不匹配，其评分将低于有效匹配的级别。

### <a name="no-match"></a>不匹配

如果主要语言子标记不匹配，其评分将低于有效匹配的级别。 例如，zh-Hant 与 zh-Hans 不匹配。

## <a name="examples"></a>示例

用户语言“zh-Hans-CN”（简体中文（中国））按所示的优先级顺序匹配以下资源： X 表示不匹配。

![匹配简体中文（中国）](images/language_matching_1.png)

1. 精确匹配；2. & 3. 区域匹配；4. 父匹配；5. 同级匹配。

当语言子标记具有在 BCP-47 子标记注册表中定义的禁止脚本值时，将发生相应的匹配，呈现禁止脚本代码的值。 例如，en-Latn-US 与 en-US 匹配。 在接下来的此示例中，用户语言为“en-AU”（英语（澳大利亚））。

![匹配英语（澳大利亚）](images/language_matching_2.png)

1. 精确匹配；2. 宏地区匹配；3. 非特定地区匹配；4. 正交相关性匹配；5. 首选区域匹配；6. 同级匹配。

## <a name="matching-a-language-to-a-language-list"></a>将一种语言与语言列表相匹配

有时，在将一种语言与语言列表相匹配的较大过程中发生匹配。 例如将基于单个语言的资源与应用的语言列表相匹配。 匹配分数将通过第一个匹配语言在列表中的位置进行加权。 语言在列表中的位置越低，分数也将越低。

当语言列表包含两个或多个具有相同语言和脚本子标记的区域变体时，仅为精确匹配、变体匹配和区域匹配对第一个语言标记的比较进行评分。 对部分匹配的评分将延迟到最后一个区域变体。 这使用户可以精确控制其语言列表的匹配行为。 匹配行为可能包括，如果第三项匹配第一项的语言和脚本，则允许列表中第二项的精确匹配优先于列表中第一项的部分匹配。 以下提供了一个示例。

- 语言列表（按顺序）：“pt-PT”（葡萄牙语（葡萄牙））、“en-US”（英语（美国））、“pt-BR”（葡萄牙语（巴西））。
- 资源：“en-US”、“pt-BR”。
- 分数较高的资源：“en-US”。
- 描述：从 pt-PT”开始比较，但找不到精确匹配。 由于用户的语言列表中存在“pt-BR”，因此部分匹配推迟到比较“pt-BR”。 下一个语言比较是“en-US”，有一个精确匹配。 因此，胜出的资源是“en-US”。

或者

- 语言列表（按顺序）：“es-MX”（西班牙语（墨西哥）、“es-HO”（西班牙语（洪都拉斯））。
- 资源：“en-ES”、“es-HO”。
- 分数较高的资源：“es-HO”。

## <a name="undetermined-language-und"></a>不确定的语言（“und”）

语言标记“und”可用来指定在没有更好的匹配的情况下匹配任何语言的资源。 可以将其视为类似于 BCP-47 语言范围“*”或“*-&lt;脚本&gt;”。 以下提供了一个示例。

- 语言列表：“en-US”、“zh-Hans-CN”。
- 资源：“zh-Hans-CN”、“und”。
- 分数较高的资源：“und”。
- 描述：从 en-US”开始比较，但找不到基于“en”的匹配（部分匹配或更好的匹配）。 由于有一个资源标记为“und”，因此匹配算法使用该资源。

标记“und”使多种语言共享一个资源，并允许将个别语言视为例外。 举个例子。

- 语言列表：“zh-Hans-CN”、“en-US”。
- 资源：“zh-Hans-CN”、“und”。
- 分数较高的资源：“zh-Hans-CN”。
- 描述：比较找到第一项的一个精确匹配，因此不检查标记为“und”的资源。

你可以使用“und”和脚本标记一起按脚本筛选资源。 举个例子。

- 语言列表：“ru”。
- 资源：“und-Latn”、“und-Cyrl”、“und-Arab”。
- 分数较高的资源：“und-Cyrl”。
- 描述：比较找不到“ru”的匹配（部分匹配或更好的匹配），因此匹配语言标记“und”。 与语言标记“ru”关联的禁止脚本值“Cyrl”匹配资源“und-Cyrl”。

## <a name="orthographic-regional-affinity"></a>正交区域相关性

当区域子标记存在差异的两个语言标记匹配时，与其他相比，特定区域对互相之间可能具有更高的接近度。 唯一支持的相关组适用于英语 (“en”)。 地区子标记“PH”（菲律宾）和“LR”（利比里亚）与“US”地区子标记具有正交相关性。 所有其他地区子标记与“GB”（英国）地区子标记相关。 因此，当“en-US”和“en-GB”资源都可用时，“en-HK”（英语（香港特别行政区））的语言列表与“en-GB”资源的匹配分数高于与“en-US”资源的匹配分数。

## <a name="handling-languages-with-many-regional-variants"></a>处理具有多种区域变体的语言

对于某些语言，不同区域均有庞大的语言使用群体，不同区域使用该语言的不同变体，&mdash;诸如英语、法语和西班牙语等语言就在多语言应用最常支持的语言之列。 区域差异可能包括正字差异（如“颜色”与“色彩”），或方言差异，如词汇（如，“卡车”与“货车”）。

这些存在重大区域变体的语言为制作全球通用的应用带来一些挑战：“应该支持多少种不同的区域变体？” “哪些变体？” “为我的应用管理这些区域变体资产的最经济的方法是什么？” 本主题所涉及的范围不包括回答所有这些问题。 但是，Windows 中的语言匹配机制的确提供能够帮助你处理区域变体的功能。

应用通常只会支持任何给定语言的一种变体。 假设某应用只有一个英语变体的资源，预计将这些资源用于讲英语的人，不管他们来自哪个区域，也是如此。 在此情况下，不带任何地区子标记的标记“en”会体现出这种预期。 但应用可能在过去曾经使用包括地区子标记的标记（如“en-US”）。 在此情况下，该标记同样有效：应用仅使用一个英语变体，并且 Windows 会使用相应的方式匹配为一个区域变体标记的资源和不同区域变体的用户语言首选项。

但如果要支持两个或多个区域变体，类似“en”与“en-US”之间的差异可能对用户体验产生重大影响，且考虑使用哪些地区子标记非常重要。

假设你要为加拿大使用的法语与欧洲法语分别提供单独的法语本地化。 对于加拿大法语，可以使用“fr-CA”。 对于来自欧洲的母语人士，本地化将使用法语（法国），因此可以使用“fr-FR”。 但是如果给定用户来自比利时，其语言首选项为“fr-BE”；他们将获得哪一个？ 地区“BE”与“FR”和“CA”都不同，表明“任何地区”与两者匹配。 但是，法国刚好是法语的首选地区，因此在此案例中，“fr-FR”将被视为最佳匹配。

假设你一开始只针对法语的一种变体使用法语（法国）字符串对你的应用进行本地化，但将其常规限定为“fr”，之后你想要添加对加拿大法语的支持。 可能只有一些特定的资源需要重新翻译成加拿大法语。 你可以继续使用所有原始资产，依然将它们限定为“fr”，并且只使用“fr-CA”添加少量新的资产集。 如果用户语言首选项为“fr-CA”，则“fr-CA”资产的匹配分数将高于“fr”资产的匹配分数。 但如果用户语言首选项为任何其他法语变体，则非特定地区的资产“fr”的匹配分数将高于“fr-CA”资产的匹配分数。

另一个示例，假设你想要为来自西班牙的母语人士和来自拉丁美洲的母语人士分别提供单独的西班牙语本地化。 进一步假设针对拉丁美洲的翻译由墨西哥的一家供应商提供。 你应该为两个资源集使用“es-ES”（西班牙）和“es-MX”（墨西哥）吗？ 如果是，这将给来自其他拉丁美洲地区（如阿根廷或哥伦比亚）的母语人士带来问题，因为他们将获得“es-ES”资源。 在此情况下，还有更好的替代方法：你可以使用宏地区子标记“es-419”来反映你想要将资产用于来自拉丁美洲或加勒比海任何部分的母语人士。

如果你想要支持多个区域变体，非特定地区的语言标记和宏地区子标记非常有效。 为最大程度地缩小所需单独资产的数量，你可以使用特定方式来限定给定资产，从而反映其适用的最广泛的范畴。 然后根据需要，使用更具体的变体来补充广泛适用的资产。 具有不确定区域语言限定符的资产可用于任何区域变体的用户，除非有适用于该用户的、具有区域更具体的限定符的其他资产。 例如，“en”资产将匹配澳大利亚英语用户，但具有“en-053”（在澳大利亚或新西兰使用的英语）的资产将更加匹配该用户，而具有“en-AU”的资产将是可能的最佳匹配。

英语需要特殊考虑。 如果某个应用为两种英语变体添加本地化，很有可能是美国英语和英国英语，或“国际”英语。 如上所述，美国以外的某些地区遵循美国拼写约定，且 Windows 语言匹配将这一点考虑在内。 在此方案中，不建议对其中一种变体使用非特定地区标记“en”；改用“en-GB”和“en-US”。 （但如果给定资源不需要单独的变体，可以使用“en”。）如果“en-GB”或“en-US”被“en”替代，这将干扰 Windows 提供的正交区域相关性。 如果添加第三种英语本地化，则根据需要为额外的变体使用特定或宏地区子标记（如“en-CA”、“en-AU”或“en-053”），但继续使用“en-GB”和“en-US”。

## <a name="related-topics"></a>相关主题

* [资源管理系统如何匹配和选择资源](how-rms-matches-and-chooses-resources.md)
* [BCP-47](http://go.microsoft.com/fwlink/p/?linkid=227302)
* [了解用户配置文件语言和应用清单语言](../design/globalizing/manage-language-and-region.md)
* [宏地理（大陆）区域、地理子区域和所选经济和其他分组的构成](http://go.microsoft.com/fwlink/p/?LinkId=247929)
